asyncapi: 2.2.0
info:
  title: FFC SFI Agreement Calculator
  version: '1.0.0'
channels:
  organisation/eligibility:
    subscribe:
      message:
        $ref: '#/components/messages/EligibilityCheck'
    publish:
      message:
        $ref: '#/components/messages/EligibilityResponse'
  organisation/eligibilityEvent:
    publish:
      message:
        $ref: '#/components/messages/EligibilityEvent'
  parcel/spatial:
    subscribe:
      message:
        $ref: '#/components/messages/ParcelSpatial'
    publish:
      message:
        $ref: '#/components/messages/ParcelSpatialResponse'
  parcel/standard:
    subscribe:
      message:
        $ref: '#/components/messages/ParcelStandard'
    publish:
      message:
        $ref: '#/components/messages/ParcelStandardResponse'

components:
  messages:
    EligibilityCheck:
      contentType: application/json
      headers:
        type: object
        properties:
          correlationId:
            type: string
            description: GUID unique to user session
          messageId:
            type: string
            description: GUID unique to message
      payload:
        type: object
        properties:
          crn:
            type: number
            description: Customer Reference Number
          callerId:
            type: number
            description: Unique reference for CRN
    EligibilityResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          eligibility:
            type: array
            description: List of organisations eligible to apply for SFI
            items:
              type: object
              properties:
                sbi:
                  type: number
                  description: Single Business Identifier
                name:
                  type: string
                  description: Organisation name
                organisationId:
                  type: number
                  description: Unique organisation Identifier
                address:
                  type: string
                  description: Organisation address
    EligibilityEvent:
      contentType: application/json
      payload:
        type: object
        properties:
          sbi:
            type: number
            description: Single Business Identifier
          eligible:
            type: boolean
            description: Result of eligibility check
          validation:
            type: array
            description: Justification reasons for result
            items:
              type: string
    ParcelSpatial:
      contentType: application/json
      headers:
        type: object
        properties:
          correlationId:
            type: string
            description: GUID unique to user session
          messageId:
            type: string
            description: GUID unique to message
      payload:
        type: object
        properties:
          organisationId:
            type: number
            description: Unique organisation reference
          sbi:
            type: number
            description: Single Business Identifier
          callerId:
            type: number
            description: Unique agreement reference for CRN
    ParcelSpatialResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          organisationId:
            type: number
            description: Unique organisation reference
          filename:
            type: string
            description: Name of file containing data
          storageUrl:
            type: string
            description: URL where data file can be retrieved
    ParcelStandard:
      contentType: application/json
      headers:
        type: object
        properties:
          correlationId:
            type: string
            description: GUID unique to user session
          messageId:
            type: string
            description: GUID unique to message
      payload:
        type: object
        properties:
          organisationId:
            type: number
            description: Unique organisation reference
          sbi:
            type: number
            description: Single Business Identifier
          callerId:
            type: number
            description: Unique agreement reference for CRN
    ParcelStandardResponse:
      contentType: application/json
      payload:
        type: object
        properties:
          organisationId:
            type: number
            description: Unique organisation reference
          filename:
            type: string
            description: Name of file containing data
          storageUrl:
            type: string
            description: URL where data file can be retrieved


